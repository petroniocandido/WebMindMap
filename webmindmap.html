<html>
<head>
</head>
<body>
	<style type="text/css" media="screen">
	 .colorpicker {
	   float: left;
	   margin: 1em;
	 }
	 form {
	   margin: 2em 1em 0 1;
	   text-align: center;
	 }
	 body {
	   font-family: "Lucida Grande", "Lucida Unicode", "Lucida Sans", sans-serif;
	 }
	 p {
	   clear: both;
	 }
	</style>
	<div id="xy">MOUSE XY</div>
	<canvas id="myCanvas" width="878" height="300"></canvas>
	<br />
	<div class="colorpicker">
  <div id="colorpicker"></div>
  <form><input type="text" id="color" /></form>
</div>
	Conteúdo: <input id="content" type="textbox" />
	<script src="jquery-1.4.3.js"></script>
	<script type="text/javascript" charset="utf-8" src="farbtastic/src/farbtastic.js"></script>
	<script src="webmindmap.js"></script>
    <script type="text/javascript" >
		var mm = new xMindMap();
		mm.setOnChangeNode(function() { $('#content').val(mm.selected.content); });
		function evtMouseClick(e) {
			mm.setEditMode(false);
			var x = e.pageX - this.offsetLeft;
			var y = e.pageY - this.offsetTop;
			$('#xy').html("X: " + x + " Y: " + y); 
			var n = mm.getNodeInXY(x,y);
			if(n != null){
				mm.setSelectedNode(n);
			}
		}
		function evtMouseDblClick(e) {
			mm.setEditMode(true);
			var x = e.pageX - this.offsetLeft;
			var y = e.pageY - this.offsetTop;
			$('#xy').html("X: " + x + " Y: " + y); 
			var n = mm.getNodeInXY(x,y);
			if(n != null){
				mm.setSelectedNode(n);
			}
		}
		function evtMouseDown(e) {
			var x = e.pageX - this.offsetLeft;
			var y = e.pageY - this.offsetTop;
			$('#xy').html("XX: " + e.clientX + " YY: " + y); 
			
		}
		function evtKey(e) {
			$('#xy').html("KEY: " + e.keyCode); 
			if(!mm.edit_mode){
				// enter
				if (e.keyCode == '13') {
					if(mm.selected != null){
						var n = new Node();
						n.setParent(mm.selected.parent);
						mm.setSelectedNode(n);
					}
				}
				// backspace
				else if (e.keyCode == '8') {
					mm.selected.setContent(mm.selected.content.substring(0,mm.selected.content.length-1));
				}
				// space
				else if (e.keyCode == '32') {
					mm.selected.toggleChildVisible();
				}
				// insert
				else if (e.keyCode == '45') {
					var newNode = new Node();
					mm.appendChild(newNode);
				}
				// delete
				else if (e.keyCode == '46') {
					mm.removeSelected();
				}
				// left arrow
				else if (e.keyCode == '37') {
					mm.changeSelectedToParent();
				}
				// up arrow
				else if (e.keyCode == '38') {
					mm.changeSelectedToPrevious();
				}
				// right arrow
				else if (e.keyCode == '39') {
					mm.changeSelectedToChild();
				}
				// down arrow
				else if (e.keyCode == '40') {
					mm.changeSelectedToNext();
				}
				/*
				else if ((parseInt(e.keyCode) >= 48 && parseInt(e.keyCode) <= 90) 
					|| (parseInt(e.keyCode) >= 107 && parseInt(e.keyCode) <= 111) 
					|| parseInt(e.keyCode) >= 186 ) {
					mm.selected.appendContent(String.fromCharCode(e.keyCode));
				}
				*/
			}
			else {
				mm.selected.appendContent(String.fromCharCode(e.keyCode));
			}
			mm.Show();
		}
		
		$(document).ready(function() {
				var pai = new Node();
				pai.setX(250).setY(200).setContent('Pai - Nó raiz').setFillColor('blue');
				mm.setRootNode(pai);
				mm.Show();
				
				//$('#myCanvas').mousemove(evt);
				$('#myCanvas').click(evtMouseClick).dblclick(evtMouseDblClick).mousedown(evtMouseDown);
				$(document).keydown(evtKey);
				$('#content').change(function(){mm.selected.setContent($('#content').val()); mm.Show();});
				//$('#color').change(function(){mm.selected.setFillColor($('#color').val()); mm.Show();});
				
				$('#colorpicker').farbtastic(function(color){
					if(mm.selected != null){
						mm.selected.setFillColor(color); 
						mm.Show();
					}
				});
  
			});
	</script>
</body>
</html>