<!doctype html>
<html>
<head>
		<link rel="stylesheet" href="webmindmap.css" type="text/css" media="screen" />
</head>
<body>
	<div id="xy">MOUSE XY</div>
	<canvas id="myCanvas" width="878" height="300"></canvas>
	<br />
	<span class="btn" id="btnEdit">Editar</span>
	<div id="details_panel">
		<div class="colorpicker">
			<div id="colorpicker"></div>
		</div>
		<form>
			<table>
				<tr>
					<td>Cor do Elemento</td> <td><input type="text" id="node_color" /></td>
				</tr>
				<tr>
					<td>Conteúdo</td> <td><textarea id="content" cols="45" rows="5"></textarea></td>
				</tr>
			</table>
		</form>
	</div>
	<div id="node_content">
		<textarea id="txtContent" cols="30" rows="3"></textarea>
		<span class="btn" id="btnOk">OK</span>
	</div>
	<div id="source" > </div>
	<script src="jquery-1.4.3.js"></script>	
	<script type="text/javascript" charset="utf-8" src="farbtastic/src/farbtastic.js"></script>
	<script src="webmindmap.js"></script>
    <script type="text/javascript" >
		$(document).ready(function() {
				var pai = new Node();
				pai
					.setX(250)
					.setY(200)
					.setContent('Pai - Nó raiz')
					.setFillColor('blue');
				xMindMap.setRootNode(pai);
				xMindMap.Show();
				
				$('#myCanvas')
					.click(UIController.OnMouseClick)
					.click(function() {
						$('#details_panel').hide();
						//$(document).keydown(UIController.OnKeyPressed);
					})
					.dblclick(function() {
						var sel = xMindMap.getSelectedNode();
						$('#node_content').css('top',sel.position.y).css('left',sel.position.x).show();
						$(document).unbind('keydown');
						$('#txtContent').val(sel.content).focusin();
					})
					.mousedown(UIController.OnMouseDown)
					.mouseup(UIController.OnMouseUp);
				$(document).keydown(UIController.OnKeyPressed);
				$('#content')
					.focusin(function(){
						$(document).unbind('keydown');
					}).focusout(function(){
						$(document).keydown(UIController.OnKeyPressed);
						$('#content').unbind('keydown');
					}).change(function(){
						xMindMap.getSelectedNode().setContent($('#content').val()); 
						xMindMap.Show();
					}).keydown(function(){
						xMindMap.Show();
					});
				$('#details_panel').hide();
				$('#node_content').hide();
				$('#btnEdit').click(function(){ 
					var sel = xMindMap.getSelectedNode();
					if(sel == null) {
						alert('Nenhum item selecionado!');
						return false;
					}
					$('#colorpicker').hide();
					$('#content').val(sel.content);
					$('#details_panel').toggle();  
				});
				$('#btnOk').click(function(){
					$(document).keydown(UIController.OnKeyPressed);
					$('#node_content').hide();
					xMindMap.getSelectedNode().setContent($('#txtContent').val());
					xMindMap.Show();
				});
				$('#colorpicker').farbtastic(function(color){
					if(xMindMap.getSelectedNode() != null){
						xMindMap.getSelectedNode().setFillColor(color); 
						xMindMap.Show();
					}
					$('#node_color').val(color);
				});
				$('#colorpicker').dblclick(function() { $('#colorpicker').hide('slow'); });
				$('#node_color').click(function() {
					$('#colorpicker').css('top',$('#node_color').css('top')).css('left',$('#node_color').css('left')).show();
				});
				xMindMap.setOnChangeNode(function() { 
					//$('#content').val(xMindMap.getSelectedNode().content); 
					$('#details_panel').hide();
					//$('#source').val(JSON.stringify(pai));
				});
  
			});
	</script>
</body>
</html>