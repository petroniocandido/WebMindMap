<!doctype html>
<html>
<head>
		<link rel="stylesheet" href="webmindmap.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="jquery.contextMenu.css" type="text/css" media="screen" />
</head>
<body>
	<div id="xy">MOUSE XY</div>
	<canvas id="myCanvas" width="878" height="300"></canvas>
	<br />
	<div class="colorpicker">
			<div id="colorpicker"></div>
	</div>	
	<div id="node_content">
		<textarea id="txtContent" cols="30" rows="3"></textarea>
		<span class="btn" id="btnOk">OK</span>
	</div>
	<div id="source" >
		<textarea id="txtSource" cols="100" rows="30"></textarea> 
		<span class="btn" id="btnExport">Exportar</span>
		<span class="btn" id="btnLoad">Carregar</span>
	</div>
	<ul id="ContextMenu" class="contextMenu">
		<li class="edit">
			<a href="#color">Cor</a>
		</li>
		<li class="edit">
			<a href="#content">Conteúdo</a>
		</li>
		<li class="edit">
			<a href="#insert">Inserir</a>
		</li>
		<li class="delete">
			<a href="#delete">Apagar</a>
		</li>
	</ul>
	<script src="jquery-1.4.3.js"></script>	
	<script type="text/javascript" charset="utf-8" src="farbtastic/src/farbtastic.js"></script>
	<script type="text/javascript" charset="utf-8" src="jquery.contextMenu.js"></script>
	<script src="webmindmap.js"></script>
    <script type="text/javascript" >
		$(document).ready(function() {
				var pai = new Node();
				pai
					.setX(250)
					.setY(200)
					.setContent('Pai - Nó raiz')
					.setFillColor('blue');
				xMindMap.setRootNode(pai);
				xMindMap.Show();
				
				$('#myCanvas')
					.click(UIController.OnMouseClick)
					.dblclick(function() {
						var sel = xMindMap.getSelectedNode();
						$('#node_content').css('top',sel.position.y).css('left',sel.position.x).show();
						$(document).unbind('keydown');
						$('#txtContent').val(sel.content).focusin();
					})
					.mousedown(UIController.OnMouseDown)					
					.mouseup(UIController.OnMouseUp)
					.contextMenu({menu:'ContextMenu'}, UIController.OnMouseRightButton);
				
				$(document).keydown(UIController.OnKeyPressed);
				
				$('#content')
					.focusin(function(){
						$(document).unbind('keydown');
					}).focusout(function(){
						$(document).keydown(UIController.OnKeyPressed);
						$('#content').unbind('keydown');
					}).change(function(){
						xMindMap.getSelectedNode().setContent($('#content').val()); 
						xMindMap.Show();
					}).keydown(function(){
						xMindMap.Show();
					});
				
				$('#node_content').hide();
				
				$('#btnOk').click(function(){
					$(document).keydown(UIController.OnKeyPressed);
					$('#node_content').hide();
					xMindMap.getSelectedNode().setContent($('#txtContent').val());
					xMindMap.Show();
				});
				
				$('#colorpicker').farbtastic(function(color){
					if(xMindMap.getSelectedNode() != null){
						xMindMap.getSelectedNode().setFillColor(color); 
						xMindMap.Show();
					}
				});
				
				$('#colorpicker').dblclick(function() { $('#colorpicker').hide('slow'); });
				
				xMindMap.setOnChangeNode(function() { 
					$('#details_panel').hide();
				});
				
				$('#btnExport').click(function() { 
					$('#txtSource').val(xMindMap.toJSON());
				});
				
				$('#btnLoad').click(function() { 
					xMindMap.load($('#txtSource').val());
				});
			});
	</script>
</body>
</html>